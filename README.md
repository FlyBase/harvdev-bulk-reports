# harvdev-bulk-reports

<!-- toc -->

- [Overview](#Overview)
- [BulkReportsSOP](#BulkReportsSOP)
  * [PipelineSummary](#PipelineSummary)
  * [NextSteps](#NextSteps)
- [TroubleShooting](#TroubleShooting)

## Overview
This repo contains scripts that are used to generate most FlyBase bulk reports, as well as reports for FlyBase curators and external collaborators. This is a new public repository that replaces the private, retired `harvdev-reports` (renamed to `harvdev-reports-old`) repository. This repo contains a mix of newer python scripts and older perl (taken from the `fb_cvs/FB/scripts/reports` repo). Bulk reports for FlyBase users are shipped off to IUDev and incorporated into the public FB site on the [Downloads page](http://flybase.org/cgi-bin/get_static_page.pl?file=bulkdata7.html&title=Current%20Release) and [FTP site](ftp://ftp.flybase.net/releases/current). Other reports are posted to internal and external FTP sites for use.  
This code is intended to run in docker using the `Bulk_Reports` GoCD pipeline (`Reporting_Build` pipeline group).  

## BulkReportsSOP

### PipelineSummary
Download files are generated by the [Bulk_Reports](http://flysql22:8153/go/admin/pipelines/Bulk_Reports/general) in `Reporting_Build` pipeline group.  
The pipeline automates these steps:  
1. Gets HarvDev docker container and builds the appropriate docker image using this repo.  
2. Saves output bulk files to the `/data/build-reporting/fb_${RELEASE}_reporting/bulk_reports` directory.  
3. Packages up files into various tarballs.  
4. Notifies HarvDev by email that the files have been generated.
Manual steps still required: 
1. Checking file sizes manually by comparing them to previous release file sizes.
- See the [Reporting Builds](https://drive.google.com/drive/folders/1lHjCrX-ee7pSaThbo4UuMJ3LWGjngKja) Google Drive directory for examples.  

### DetailedSOP
1. Review the `Environment variables` for the `Reporting_Build` GoCD pipeline group. They should've been updated in earlier release build steps, but double check them.  
2. Run the pipeline.  
3. When the files have been generated, upon receiving the email, check files sizes.  

### NextSteps
1. If files look good, manually start the `Upload_Reporting_Build` GoCD pipeline, which will upload all files related to the release build for various users.  

## TroubleShooting
The [Reporting Build SOP](https://github.com/FlyBase/harvdev-docs/blob/master/reporting_build/reporting_build_sop.md#TroubleShooting) discusses various troubleshooting scenarios for dealing with failed scripts and GoCD pipelines.
